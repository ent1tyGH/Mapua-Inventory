<div class="container">
  <div class="form-card">
    <h2>Items</h2>

    <form (ngSubmit)="addItem()">
      <label>Equipment Type:</label>
      <select [(ngModel)]="newItem.equipmentType.id" name="equipmentTypeId" required>
        <option *ngFor="let type of equipmentTypes" [value]="type.id">{{ type.name }}</option>
      </select>

      <label>Specifications:</label>
      <input type="text" [(ngModel)]="newItem.specifications" name="specifications" required />

      <label>Location:</label>
      <input type="text" [(ngModel)]="newItem.location" name="location" required />

      <label>Condition:</label>
      <select [(ngModel)]="newItem.conditionStatus" name="conditionStatus" required>
        <option>WORKING</option>
        <option>NEEDS_REPAIR</option>
        <option>DISPOSED</option>
      </select>

      <button type="submit">Add Item</button>
      <button type="button" class="btn btn-primary" [routerLink]="'/equipment-type/add'">
        Add Equipment Type
      </button>
    </form>

    <div class="item-list">
      <div class="item-card" *ngFor="let item of items">
        <h3>{{ item.equipmentType?.name }} (ID: {{ item.id }})</h3>
        <p><strong>Specs:</strong> {{ item.specifications }}</p>
        <p><strong>Location:</strong> {{ item.location }}</p>

        <p>
          <strong>Condition:</strong>
          <span class="badge"
                [ngClass]="{
              'badge-working': item.conditionStatus === 'WORKING',
              'badge-repair': item.conditionStatus === 'NEEDS_REPAIR',
              'badge-disposed': item.conditionStatus === 'DISPOSED'
            }">
        {{ item.conditionStatus }}
      </span>
        </p>

        <p>
          <strong>Borrowed:</strong>
          <span class="badge"
                [ngClass]="{
              'badge-yes': item.borrowed,
              'badge-no': !item.borrowed
            }">
        {{ item.borrowed ? 'Yes' : 'No' }}
      </span>
        </p>

        <button
          class="borrow-btn"
          [routerLink]="['/borrowers']"
          [queryParams]="{ itemId: item.id }">
          Borrow
        </button>

        <button class="btn btn-secondary" (click)="editItem(item)">
          <i class="fas fa-edit"></i> Edit
        </button>

        <div *ngIf="isEditing && selectedItem?.id === item.id" class="edit-form">
          <hr>
          <h3>Update Item</h3>
          <form (ngSubmit)="updateItem()">

            <label>Equipment Type:</label>
            <select [(ngModel)]="selectedItem!.equipmentType.id" name="updateEquipmentTypeId" required>
              <option *ngFor="let type of equipmentTypes" [value]="type.id">{{ type.name }}</option>
            </select>

            <label>Specifications:</label>
            <input type="text" [(ngModel)]="selectedItem!.specifications" name="updateSpecifications" required />

            <label>Location:</label>
            <input type="text" [(ngModel)]="selectedItem!.location" name="updateLocation" required />

            <label>Condition:</label>
            <select [(ngModel)]="selectedItem!.conditionStatus" name="updateConditionStatus" required>
              <option>WORKING</option>
              <option>NEEDS_REPAIR</option>
              <option>DISPOSED</option>
            </select>

            <button type="submit" class="btn btn-success">Save Changes</button>
            <button type="button" class="btn btn-light" (click)="cancelEdit()">Cancel</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
