<div class="item-container">
  <h2>Items</h2>

  <!-- Form to add new item -->
  <form (ngSubmit)="addItem()">
    <label>Equipment Type:</label>
    <select [(ngModel)]="newItem.equipmentType.id" name="equipmentTypeId" required>
      <option *ngFor="let type of equipmentTypes" [value]="type.id">{{ type.name }}</option>
    </select>

    <label>Specifications:</label>
    <input type="text" [(ngModel)]="newItem.specifications" name="specifications" required />

    <label>Location:</label>
    <input type="text" [(ngModel)]="newItem.location" name="location" required />

    <label>Condition:</label>
    <select [(ngModel)]="newItem.conditionStatus" name="conditionStatus" required>
      <option>WORKING</option>
      <option>NEEDS_REPAIR</option>
      <option>DISPOSED</option>
    </select>

    <button type="submit">Add Item</button>
  </form>

  <button type="button" class="btn btn-primary" [routerLink]="'/equipment-type/add'">
    Add Equipment Type
  </button>

  <!-- List of existing items -->
  <ul>
    <li *ngFor="let item of items" class="item-entry">
      {{ item.equipmentType?.name }} - {{ item.specifications }} - {{ item.location }}
      ({{ item.conditionStatus }})

      <!-- Borrowed status with hover -->
      <span
        *ngIf="item.borrowed"
        class="borrowed-label"
        (mouseenter)="hoveredItem = item.id!"
        (mouseleave)="hoveredItem = null">
        Borrowed
      </span>
      <span *ngIf="!item.borrowed" class="available-label">
        Available
      </span>

      <!-- Borrower details tooltip -->
      <div
        *ngIf="item.borrowed && hoveredItem === item.id && item.borrowRecords?.length"
        class="borrower-tooltip">
        <small *ngIf="item.borrowRecords[item.borrowRecords.length - 1] as lastRecord">
          By: {{ lastRecord.borrower?.studentName }}
          ({{ lastRecord.borrower?.studentNumber }})
          on {{ lastRecord.borrowedAt | date:'short' }}
        </small>
      </div>

      <!-- Borrow / Return actions -->
      <button *ngIf="!item.borrowed" [routerLink]="['/borrow', item.id]">
        Borrow
      </button>
      <button *ngIf="item.borrowed" (click)="returnItem(item)">
        Return
      </button>
    </li>
  </ul>
</div>
